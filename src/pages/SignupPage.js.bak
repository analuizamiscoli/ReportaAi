import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { Card, Form, Button, Row, Col } from 'react-bootstrap';
import BackButton from '../components/BackButton';
import './AuthForm.css';

// Página de Cadastro de novo usuário
function SignupPage() {
  const navigate = useNavigate();
  // Estado para guardar os dados do endereço que são preenchidos automaticamente pelo CEP.
  const [address, setAddress] = useState({
      rua: '',
      bairro: '',
      cidade: 'Juiz de Fora',
      estado: 'MG'
  });

  // Função chamada quando o usuário tira o foco do campo CEP.
  const handleCepBlur = (e) => {
    const cep = e.target.value.replace(/[^0-9]/g, ''); // Limpa o CEP, deixando apenas números.
    if (cep.length !== 8) {
      return; // Se não tem 8 dígitos, não faz nada.
    }

    // Busca o CEP na API pública ViaCEP.
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
      .then(res => res.json())
      .then(data => {
        if (!data.erro) {
            // Se encontrou, atualiza os campos de rua e bairro.
            setAddress(prev => ({ 
                ...prev,
                rua: data.logradouro,
                bairro: data.bairro,
            }));
        }
      });
  };

  // Função chamada quando o formulário de cadastro é enviado.
  const handleSignup = (e) => {
    e.preventDefault();
    // Lógica de cadastro simulada.
    // Em um app real, aqui os dados seriam enviados para uma API para criar o usuário no banco de dados.
    console.log('Usuário cadastrado!');
    navigate('/mapa'); // Redireciona para o mapa após o cadastro.
  };

  return (
    <div className="auth-page">
        <BackButton to="/" />
        <div className="auth-form-container">
            <Link to="/" className="auth-logo">Reporta Aí</Link>
            <Card>
                <Card.Body>
                <Card.Title as="h2" className="text-center mb-4">Cadastrar-se</Card.Title>
                <Form onSubmit={handleSignup}>
                    <Form.Group className="mb-3" controlId="formBasicName">
                        <Form.Label>Nome Completo</Form.Label>
                        <Form.Control type="text" placeholder="Seu nome" required />
                    </Form.Group>

                    <Form.Group className="mb-3" controlId="formBasicCpf">
                        <Form.Label>CPF</Form.Label>
                        <Form.Control type="text" placeholder="___.___.___-__" required />
                    </Form.Group>

                    <Form.Group className="mb-3" controlId="formBasicEmail">
                        <Form.Label>Email</Form.Label>
                        <Form.Control type="email" placeholder="seu@email.com" required />
                    </Form.Group>

                    <Form.Group className="mb-3" controlId="formBasicPassword">
                        <Form.Label>Senha</Form.Label>
                        <Form.Control type="password" placeholder="Crie uma senha" required />
                    </Form.Group>

                    <hr />

                    <Row>
                        <Col md={6}>
                            <Form.Group className="mb-3" controlId="formBasicCep">
                                <Form.Label>CEP</Form.Label>
                                <Form.Control type="text" placeholder="_____-___" onBlur={handleCepBlur} required />
                            </Form.Group>
                        </Col>
                    </Row>

                    <Form.Group className="mb-3" controlId="formBasicStreet">
                        <Form.Label>Rua</Form.Label>
                        <Form.Control type="text" placeholder="Sua rua" value={address.rua} onChange={e => setAddress({...address, rua: e.target.value})} required />
                    </Form.Group>

                    <Row>
                        <Col md={6}>
                            <Form.Group className="mb-3" controlId="formBasicNumber">
                                <Form.Label>Número</Form.Label>
                                <Form.Control type="text" placeholder="Nº" required />
                            </Form.Group>
                        </Col>
                        <Col md={6}>
                            <Form.Group className="mb-3" controlId="formBasicNeighborhood">
                                <Form.Label>Bairro</Form.Label>
                                <Form.Control type="text" placeholder="Seu bairro" value={address.bairro} onChange={e => setAddress({...address, bairro: e.target.value})} required />
                            </Form.Group>
                        </Col>
                    </Row>

                    <Button variant="primary" type="submit" className="w-100 mt-3">
                    Criar Conta
                    </Button>
                </Form>
                </Card.Body>
                <Card.Footer className="text-center">
                    <small className="text-muted">
                        Já tem uma conta? <Link to="/login">Entrar</Link>
                    </small>
                </Card.Footer>
            </Card>
        </div>
    </div>
  );
}

export default SignupPage;